<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Getting started - Antenna Platform Documentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Getting started";
        var mkdocs_page_input_path = "sections/dev-guide/developer-guide.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Antenna Platform Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/account-creation/">Account creation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/project-creation/">Creating a project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/uploading-data/">Uploading data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/reviewing-data/">Reviewing imported data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/processing-data/">Processing data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/browsing-processed-data/">Browsing processed data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/validating-data/">Validating data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/visualizing-data/">Visualizing data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../user-guide/exporting-data/">Exporting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Getting started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#development">Development</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#frontend">Frontend</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#dependencies">Dependencies</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#installation">Installation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backend">Backend</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#dependencies_1">Dependencies</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#helpful-commands">Helpful Commands</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#project-data-storage">Project Data Storage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#email">Email</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#database">Database</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#backup-and-restore">Backup and Restore</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reset-the-database">Reset the database</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#show-backups">Show backups</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#restore-a-backup">Restore a backup</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#load-fixtures-with-test-data">Load fixtures with test data</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Antenna Platform Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Developer Guide</li>
      <li class="breadcrumb-item active">Getting started</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="getting-started">Getting started</h1>
<p>Antenna uses <a href="https://docs.docker.com/get-docker/">Docker</a> &amp; <a href="https://docs.docker.com/compose/install/">Docker Compose</a> to run all services locally for development.</p>
<p>1) Install Docker for your host operating (Linux, macOS, Windows)</p>
<p>2) Add the following to your <code>/etc/hosts</code> file in order to see and process the demo source images. This makes the hostname <code>minio</code> and <code>django</code> alias for <code>localhost</code> so the same image URLs can be viewed in the host machine's web browser and be processed by the ML services. This can be skipped if you are using an external image storage service.</p>
<pre><code>    127.0.0.1 minio
    127.0.0.1 django
</code></pre>
<p>2) The following commands will build all services, run them in the background, and then stream the logs.</p>
<pre><code class="language-sh">    docker compose up -d
    docker compose logs -f django celeryworker ui
    # Ctrl+c to close the logs
</code></pre>
<p>3) Optionally, run additional ML processing services: <code>processing_services</code> defines ML backends which wrap detections in our FastAPI response schema. The <code>example</code> app demos how to add new pipelines, algorithms, and models. See the detailed instructions in <code>processing_services/README.md</code>.</p>
<pre><code>docker compose -f processing_services/example/docker-compose.yml up -d
# Once running, in Antenna register a new processing service called: http://ml_backend_example:2000
</code></pre>
<p>4) Access the platform the following URLs:</p>
<ul>
<li>Primary web interface: http://localhost:4000</li>
<li>API browser: http://localhost:8000/api/v2/</li>
<li>Django admin: http://localhost:8000/admin/</li>
<li>OpenAPI / Swagger documentation: http://localhost:8000/api/v2/docs/</li>
</ul>
<p>A default user will be created with the following credentials. Use these to log into the web UI or the Django admin.</p>
<ul>
<li>Email: <code>antenna@insectai.org</code></li>
<li>Password: <code>localadmin</code></li>
</ul>
<p>5) Stop all services with:</p>
<pre><code>$ docker compose down
</code></pre>
<h2 id="development">Development</h2>
<p>Install the pre-commit tool to run linting &amp; formatting checks <em>before</em> each git commit. It's typical to install this tool using your system-wide python.</p>
<pre><code>pip install pre-commit  # Install pre-commit system-wide
pre-commit install  # Install the hook for our project
</code></pre>
<h3 id="frontend">Frontend</h3>
<h4 id="dependencies">Dependencies</h4>
<ul>
<li><a href="https://nodejs.org/en/download/">Node.js</a></li>
<li><a href="https://yarnpkg.com/getting-started/install">Yarn</a></li>
</ul>
<h4 id="configuration">Configuration</h4>
<p>By default this will try to connect to http://localhost:8000 for the backend API. Use the env var <code>API_PROXY_TARGET</code> to change this. You can create multiple <code>.env</code> files in the <code>ui/</code> directory for different environments or configurations. For example, use <code>yarn start --mode staging</code> to load <code>.env.staging</code> and point the <code>API_PROXY_TARGET</code> to a remote backend.</p>
<h4 id="installation">Installation</h4>
<p>Note: if you installed the ui using Docker first (as instructed in the quick-start) then your local <code>node_modules/</code> directory will be owned by root. Change the permissions with:
<code>sudo chown -R ${UID}:${UID} ui/node_modules</code>. The version of Node on your host machine must match that of the Docker container (which will be the case if you follow the <code>nvm</code> instructions below.)</p>
<pre><code class="language-bash"># Enter into the ui directory
cd ui
# Install Node Version Manager
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
# Install required Node.js version
nvm install
# Install Yarn dependencies
yarn install
# Start the frontend
yarn start
</code></pre>
<p>Visit http://localhost:3000/</p>
<h3 id="backend">Backend</h3>
<h4 id="dependencies_1">Dependencies</h4>
<ul>
<li><a href="https://docs.docker.com/get-docker/">Docker</a></li>
<li><a href="https://docs.docker.com/compose/install/">Docker Compose</a></li>
</ul>
<p>All backend packages are installed in the docker containers, however for faster auto-completion and intellisense, you can install them on the host machine:</p>
<pre><code class="language-bash">python -m venv venv
source venv/bin/activate
pip install -r requirements/local.txt
</code></pre>
<h4 id="helpful-commands">Helpful Commands</h4>
<h5 id="run-the-docker-compose-stack-in-the-background">Run the docker compose stack in the background</h5>
<pre><code>docker compose up -d
</code></pre>
<h5 id="watch-the-logs-of-django-the-backend-workers">Watch the logs of Django &amp; the backend workers</h5>
<pre><code>docker compose logs -f django celeryworker
</code></pre>
<h5 id="watch-the-logs-of-all-services">Watch the logs of all services:</h5>
<pre><code>docker compose logs -f
</code></pre>
<h5 id="create-a-super-user-account">Create a super user account:</h5>
<pre><code>docker compose run --rm django python manage.py createsuperuser
</code></pre>
<h5 id="create-a-fresh-demo-project-with-synthetic-data">Create a fresh demo project with synthetic data</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py create_demo_project
</code></pre>
<h5 id="run-tests">Run tests</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py test
</code></pre>
<h5 id="run-tests-with-a-specific-pattern-in-the-test-name">Run tests with a specific pattern in the test name</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py test -k pattern
</code></pre>
<h5 id="run-tests-and-drop-into-interactive-shell-on-failure">Run tests and drop into interactive shell on failure</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py test -k pattern --failfast --pdb
</code></pre>
<h5 id="speed-up-development-of-tests-by-reusing-the-db-between-test-runs">Speed up development of tests by reusing the db between test runs</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py test --keepdb
</code></pre>
<h5 id="run-management-scripts">Run management scripts</h5>
<pre><code class="language-bash">docker compose run django python manage.py --help
</code></pre>
<h5 id="launch-the-django-shell">Launch the Django shell:</h5>
<pre><code>docker compose exec django python manage.py shell

&gt;&gt;&gt; from ami.main.models import SourceImage, Occurrence
&gt;&gt;&gt; SourceImage.objects.all(project__name='myproject')
</code></pre>
<h5 id="install-backend-dependencies-locally-for-ide-support-intellisense-etc">Install backend dependencies locally for IDE support (Intellisense, etc):</h5>
<pre><code class="language-bash">python -m venv venv
source venv/bin/activate
pip install -r requirements/local.txt
</code></pre>
<h5 id="generate-openapi-schema">Generate OpenAPI schema</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py spectacular --api-version 'api' --format openapi --file ami-openapi-schema.yaml
</code></pre>
<h5 id="generate-typescript-types-from-openapi-schema">Generate TypeScript types from OpenAPI schema</h5>
<pre><code class="language-bash">docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli generate -i /local/ami-openapi-schema.yaml -g typescript-axios -o /local/ui/src/api-schema.d.ts
</code></pre>
<h5 id="generate-diagram-graph-of-django-models-relationships-graphviz-required">Generate diagram graph of Django models &amp; relationships (Graphviz required)</h5>
<pre><code class="language-bash">docker compose run --rm django python manage.py graph_models -a -o models.dot --dot
dot -Tsvg  models.dot &gt; models.svg
</code></pre>
<h2 id="project-data-storage">Project Data Storage</h2>
<p>Each project manages its own external data storage where the AMI Platform will index and process images. This is most typically a public or private S3 bucket at a cloud provider that is not AWS. For example, the Swift object storage service at Compute Canada or a university's own storage service.</p>
<p>To test the S3 storage backend locally, Minio is configured to run as part of the docker compose stack.</p>
<p>To configure a project connect to the Minio service, you can use the following config:</p>
<pre><code>Endpoint URL: http://minio:9000
Access key: amistorage
Secret access key: amistorage
Public base URL: http://minio:9000/ami/
Bucket: ami
</code></pre>
<ul>
<li>Open the Minio web interface at http://localhost:9001 and login with the access key and secret access key.</li>
<li>Upload some test images to a subfolder in the <code>ami</code> bucket (one subfolder per deployment)</li>
<li>Give the bucket or folder anonymous access using the "Anonymous access" button in the Minio web interface.</li>
<li>Both public and private buckets with presigned URLs should work.</li>
<li>Add entries to your local <code>/etc/hosts</code> file to map the <code>minio</code> and <code>django</code> hostnames to localhost so the same image URLs can be viewed in your host machine's browser and processed in the backend containers.</li>
</ul>
<pre><code>127.0.0.1 minio
127.0.0.1 django
</code></pre>
<h2 id="email">Email</h2>
<p>The local environment uses the <code>console</code> email backend. To view emails sent by the platform, check the console output (run the <code>docker compose logs -f django celeryworker</code> command).</p>
<h2 id="database">Database</h2>
<p>The local environment uses a local PostgreSQL database in a Docker container.</p>
<h3 id="backup-and-restore">Backup and Restore</h3>
<pre><code>docker compose run --rm postgres backup
</code></pre>
<h3 id="reset-the-database">Reset the database</h3>
<pre><code>docker compose run --rm django python manage.py reset_db
</code></pre>
<h3 id="show-backups">Show backups</h3>
<pre><code>docker compose run --rm postgres backups
</code></pre>
<h3 id="restore-a-backup">Restore a backup</h3>
<pre><code>docker compose run --rm postgres restore &lt;backup_file_name&gt;
</code></pre>
<h3 id="load-fixtures-with-test-data">Load fixtures with test data</h3>
<pre><code>docker compose run --rm django python manage.py migrate
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../user-guide/exporting-data/" class="btn btn-neutral float-left" title="Exporting"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../user-guide/exporting-data/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
